---
title: "March Madness 2019"
author: "Scott Stoltzman"
date: "3/19/2019"
output: html_document
---

#### All data from:  
https://www.kaggle.com/c/mens-machine-learning-competition-2019/data

```{r setup, include=FALSE}
# Setting everything for initial analysis, will add warning = FALSE when going to knit for real
knitr::opts_chunk$set(echo = TRUE, message = FALSE, include = FALSE)
library(tidyverse)
```
  

```{r raw_data}
raw_seeds = read_csv('input/DataFiles/NCAATourneySeeds.csv')
raw_season_results = read_csv('input/Prelim2019_RegularSeasonCompactResults.csv')
raw_tournament_results = read_csv('input/DataFiles/NCAATourneyCompactResults.csv')
raw_team_names = read_csv('input/DataFiles/Teams.csv')
raw_coaches = read_csv('input/Prelim2019_TeamCoaches.csv')
```


```{r filter_functions}
filter_gte_year = "2003"

general_filter = function(df){
  df = df %>%
    filter(Season >= filter_gte_year)
  return(df)
}

```


```{r data}
seeds = raw_seeds %>% 
  general_filter() %>%
  mutate(seed = parse_number(Seed)) %>%
  select(-Seed)

coaches = raw_coaches %>%
  general_filter()
  
season_results = raw_season_results %>% 
  general_filter() %>%
  select(Season, DayNum, WTeamID, LTeamID, LScore, WScore) %>%
  mutate(game_type = 'season')

tournament_results = raw_tournament_results %>% 
  general_filter()  %>%
  select(Season, DayNum, WTeamID, LTeamID, LScore, WScore) %>%
  mutate(game_type = 'tournament')

all_team_results = season_results %>% 
  bind_rows(tournament_results)

all_results = all_team_results %>%
  left_join(seeds, by = c('Season', 'WTeamID' = 'TeamID')) %>%
  rename(WSeed = seed) %>%
  left_join(seeds, by = c('Season', 'LTeamID' = 'TeamID')) %>%
  rename(LSeed = seed)
```

```{r score_calculations}
winning_team_scoring = all_results %>%
  select(Season, game_type, WTeamID, WScore, WSeed) %>%
  rename(team_id = WTeamID, score = WScore, seed = WSeed) %>%
  mutate(win = TRUE) %>%
  drop_na()

losing_team_scoring = all_results %>%
  select(Season, game_type, LTeamID, LScore, LSeed) %>%
  rename(team_id = LTeamID, score = LScore, seed = LSeed) %>%
  mutate(win = TRUE) %>%
  drop_na()

team_scoring = winning_team_scoring %>% 
  bind_rows(losing_team_scoring)
  
  
team_scoring
```


